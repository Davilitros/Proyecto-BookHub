<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="#{app.title} + ' - ' + #{nav.books}"></title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background-color: #fff8f2;
        }

        .navbar {
            background-color: #ff914d;
        }

        .btn-orange {
            background-color: #ff914d;
            color: white;
        }

        .btn-orange:hover {
            background-color: #e67e22;
            color: white;
        }

        .card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
    </style>
</head>

<body>

	<nav class="navbar navbar-expand-lg navbar-dark" style="background-color: #ff914d;">
	    <div class="container">
	        <!-- Logo / TÃ­tulo -->
	        <a class="navbar-brand fw-bold" href="/books">ðŸ“š BookHub</a>

	        <!-- Links de idioma -->
	        <div class="me-auto">
	            <a class="text-white me-2" th:href="@{?lang=es}">ES</a>
	            <a class="text-white" th:href="@{?lang=en}">EN</a>
	        </div>

	        <!-- Usuario logueado y logout -->
	        <div class="d-flex align-items-center">
	            <span class="text-white me-3" th:if="${#authentication.authenticated}" 
	                  th:text="${#authentication.name}">Usuario</span>
					  <!-- Logout -->
					  <a th:if="${#authentication.authenticated}" 
					     th:href="@{/logout}" 
					     class="btn btn-sm btn-outline-light"
					     th:text="#{nav.logout}">Logout</a>

					  <!-- Login -->
					  <a th:if="${!#authentication.authenticated}" 
					     th:href="@{/login}" 
					     class="btn btn-sm btn-outline-light"
					     th:text="#{nav.login}">Login</a>
	        </div>
	    </div>
	</nav>

<div class="container mt-4">

    <!-- Buscador -->
    <div class="row mb-4">
        <div class="col-md-6">
            <form th:action="@{/books/search}" method="get" class="d-flex">
                <input type="text"
                       class="form-control me-2"
                       name="q"
                       th:placeholder="#{search.placeholder}"
                       th:value="${query}">
                <button class="btn btn-orange" type="submit"
                        th:text="#{search.button}"></button>
            </form>
        </div>
    </div>

    <!-- Lista de libros -->
    <div class="row">
        <div class="col-md-4 mb-4" th:each="book : ${books}">
            <div class="card h-100">

                <img th:if="${book.imageUrl != null}"
                     th:src="${book.imageUrl}"
                     class="card-img-top"
                     style="height: 250px; object-fit: cover;">

                <div class="card-body">
                    <h5 class="card-title">
                        <a th:href="@{'/books/' + ${book.id}}"
                           th:text="${book.title}"
                           class="text-decoration-none text-dark fw-bold"></a>
                    </h5>

                    <p class="text-muted" th:text="${book.author}"></p>

                    <p class="card-text"
                       th:text="${#strings.abbreviate(book.description, 100)}"></p>
                </div>

				<div class="card-footer bg-white border-0 d-flex justify-content-between" 
				     th:if="${#authorization.expression('hasRole(''ADMIN'')')}">
				    
				    <div>
				        <span class="fw-bold me-1" th:text="#{book.createdBy} + ':'"></span>
				        <small class="text-muted" th:text="${book.user.username}"></small>
				    </div>

				    <a th:href="@{'/books/delete/' + ${book.id}}"
				       class="btn btn-sm btn-outline-danger">
				        <span th:text="#{book.delete}">Eliminar</span>
				    </a>
				</div>

            </div>
        </div>
    </div>

    <!-- BotÃ³n agregar -->
    <div class="text-end mt-3">
		<a th:if="${#authorization.expression('hasRole(''ADMIN'')')}"
		   th:href="@{/books/add}"
		   class="btn btn-orange"
		   th:text="#{book.add}">Agregar libro</a>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>